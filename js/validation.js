class FormValidator{constructor(){this.errors={},this.init()}init(){this.setupOrderFormValidation()}setupOrderFormValidation(){const e=document.getElementById("checkout-form"),r=document.getElementById("cancel-order-button");e&&(e.addEventListener("submit",(e=>{e.preventDefault(),this.validateOrderForm()})),this.setupRealTimeValidation()),r&&r.addEventListener("click",(()=>{this.closeOrderForm()}))}setupRealTimeValidation(){["customer-name","customer-email","customer-phone","customer-address"].forEach((e=>{const r=document.getElementById(e);r&&(r.addEventListener("blur",(()=>{this.validateField(e,r.value)})),r.addEventListener("input",(()=>{this.clearFieldError(e)})))}))}validateOrderForm(){const e={name:document.getElementById("customer-name").value.trim(),email:document.getElementById("customer-email").value.trim(),phone:document.getElementById("customer-phone").value.trim(),address:document.getElementById("customer-address").value.trim()};if(this.errors={},e.name?e.name.length<2?this.errors.name="Имя должно содержать не менее 2 символов":/^[a-zA-Zа-яА-ЯёЁ\s\-]+$/.test(e.name)||(this.errors.name="Имя может содержать только буквы, пробелы и дефисы"):this.errors.name="Поле обязательно для заполнения",e.email){/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(this.errors.email="Введите корректный email адрес")}else this.errors.email="Поле обязательно для заполнения";if(e.phone){const r=/^(\+7|8)[\s\-]?\(?[0-9]{3}\)?[\s\-]?[0-9]{3}[\s\-]?[0-9]{2}[\s\-]?[0-9]{2}$/,t=e.phone.replace(/\s|\-|\(|\)/g,"");r.test(e.phone)&&11===t.length||(this.errors.phone="Введите корректный номер телефона")}else this.errors.phone="Поле обязательно для заполнения";e.address?e.address.length<10&&(this.errors.address="Адрес должен содержать не менее 10 символов"):this.errors.address="Поле обязательно для заполнения",0===Object.keys(this.errors).length?this.submitOrder(e):this.displayErrors()}validateField(e,r){switch(r=r.trim(),e){case"customer-name":r?r.length<2?this.setFieldError(e,"Имя должно содержать не менее 2 символов"):/^[a-zA-Zа-яА-ЯёЁ\s\-]+$/.test(r)?this.clearFieldError(e):this.setFieldError(e,"Имя может содержать только буквы, пробелы и дефисы"):this.setFieldError(e,"Поле обязательно для заполнения");break;case"customer-email":if(r){/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)?this.clearFieldError(e):this.setFieldError(e,"Введите корректный email адрес")}else this.setFieldError(e,"Поле обязательно для заполнения");break;case"customer-phone":if(r){const t=/^(\+7|8)[\s\-]?\(?[0-9]{3}\)?[\s\-]?[0-9]{3}[\s\-]?[0-9]{2}[\s\-]?[0-9]{2}$/,s=r.replace(/\s|\-|\(|\)/g,"");t.test(r)&&11===s.length?this.clearFieldError(e):this.setFieldError(e,"Введите корректный номер телефона")}else this.setFieldError(e,"Поле обязательно для заполнения");break;case"customer-address":r?r.length<10?this.setFieldError(e,"Адрес должен содержать не менее 10 символов"):this.clearFieldError(e):this.setFieldError(e,"Поле обязательно для заполнения")}}setFieldError(e,r){const t=document.getElementById(e).closest(".form-group"),s=t.querySelector(".form-group__error");t.classList.add("form-group--error"),s.textContent=r,s.style.display="block"}clearFieldError(e){document.getElementById(e).closest(".form-group").classList.remove("form-group--error")}displayErrors(){document.querySelectorAll(".form-group").forEach((e=>{e.classList.remove("form-group--error")})),Object.keys(this.errors).forEach((e=>{const r=`customer-${e}`;this.setFieldError(r,this.errors[e])}));const e=Object.keys(this.errors)[0];if(e){const r=document.getElementById(`customer-${e}`);r&&r.focus()}}submitOrder(e){const r={...e,items:window.cartManager?window.cartManager.items:[],total:window.cartManager?window.cartManager.getTotal():0,paymentMethod:document.getElementById("payment-method").value,orderDate:(new Date).toISOString(),orderId:"TS"+Date.now()};this.showLoading(),setTimeout((()=>{this.hideLoading(),this.showSuccessMessage(r),this.clearCart(),this.closeOrderForm(),this.resetOrderForm()}),2e3)}showLoading(){const e=document.querySelector('#checkout-form button[type="submit"]'),r=e.textContent;e.innerHTML='<span class="loading-spinner"></span> Обработка...',e.disabled=!0,e.dataset.originalText=r}hideLoading(){const e=document.querySelector('#checkout-form button[type="submit"]'),r=e.dataset.originalText;e.innerHTML=r,e.disabled=!1}showSuccessMessage(e){const r=`\n            Заказ №${e.orderId} успешно оформлен!\n            \n            Детали заказа:\n            - Итого: ${this.formatPrice(e.total)}\n            - Способ оплаты: ${"card"===e.paymentMethod?"Банковская карта":"Наличные при получении"}\n            - Адрес доставки: ${e.address}\n            \n            Спасибо за покупку! Наш менеджер свяжется с вами для подтверждения заказа.\n        `;alert(r.replace(/^\s+/gm,""))}clearCart(){window.cartManager&&window.cartManager.clearCart()}closeOrderForm(){const e=document.getElementById("order-form-container");e&&(e.classList.add("hidden"),document.body.style.overflow="")}resetOrderForm(){const e=document.getElementById("checkout-form");e&&e.reset()}formatPrice(e){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0}).format(e)}validateFeedbackForm(e){const r={};if((!e.name||e.name.trim().length<2)&&(r.name="Имя должно содержать не менее 2 символов"),e.email){/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(r.email="Введите корректный email адрес")}else r.email="Поле обязательно для заполнения";return(!e.message||e.message.trim().length<10)&&(r.message="Сообщение должно содержать не менее 10 символов"),{isValid:0===Object.keys(r).length,errors:r}}}document.addEventListener("DOMContentLoaded",(()=>{window.formValidator=new FormValidator;const e=document.createElement("style");e.textContent="\n        .loading-spinner {\n            display: inline-block;\n            width: 16px;\n            height: 16px;\n            border: 2px solid #ffffff;\n            border-radius: 50%;\n            border-top-color: transparent;\n            animation: spin 1s ease-in-out infinite;\n            margin-right: 8px;\n        }\n        \n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n        \n        .product-card__meta {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 1rem;\n            font-size: 0.9rem;\n        }\n        \n        .product-rating {\n            color: var(--warning-color);\n        }\n        \n        .product-stock {\n            padding: 0.25rem 0.5rem;\n            border-radius: var(--border-radius);\n            font-size: 0.8rem;\n            font-weight: bold;\n        }\n        \n        .in-stock {\n            background: var(--success-color);\n            color: white;\n        }\n        \n        .out-of-stock {\n            background: var(--secondary-color);\n            color: white;\n        }\n        \n        .order-item {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 0.5rem;\n            padding-bottom: 0.5rem;\n            border-bottom: 1px solid #dee2e6;\n        }\n    ",document.head.appendChild(e)}));