class CartManager{constructor(){this.items=[],this.loadFromStorage(),this.setupEventListeners(),this.updateCartUI()}setupEventListeners(){const t=document.querySelector(".cart-button"),e=document.querySelector(".cart-modal__close"),r=document.getElementById("overlay");t&&t.addEventListener("click",(()=>{this.openCart()})),e&&e.addEventListener("click",(()=>{this.closeCart()})),r&&r.addEventListener("click",(()=>{this.closeCart()}));const o=document.getElementById("clear-cart-button"),n=document.getElementById("checkout-button");o&&o.addEventListener("click",(()=>{this.clearCart()})),n&&n.addEventListener("click",(()=>{this.checkout()})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&(this.closeCart(),this.closeOrderForm())}))}addToCart(t){const e=this.items.find((e=>e.id===t.id));e?e.quantity+=1:this.items.push({...t,quantity:1}),this.saveToStorage(),this.updateCartUI(),this.showNotification("–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É"),this.openCart()}removeFromCart(t){this.items=this.items.filter((e=>e.id!==t)),this.saveToStorage(),this.updateCartUI(),0===this.items.length&&this.closeCart()}updateQuantity(t,e){if(e<=0)return void this.removeFromCart(t);const r=this.items.find((e=>e.id===t));r&&(r.quantity=e,this.saveToStorage(),this.updateCartUI())}clearCart(){0!==this.items.length&&confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?")&&(this.items=[],this.saveToStorage(),this.updateCartUI(),this.closeCart(),this.showNotification("–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞"))}checkout(){0!==this.items.length?(this.closeCart(),this.showOrderForm()):alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞")}getTotal(){return this.items.reduce(((t,e)=>t+e.price*e.quantity),0)}getTotalItems(){return this.items.reduce(((t,e)=>t+e.quantity),0)}saveToStorage(){try{localStorage.setItem("techstore_cart",JSON.stringify(this.items))}catch(t){console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã:",t)}}loadFromStorage(){try{const t=localStorage.getItem("techstore_cart");t&&(this.items=JSON.parse(t))}catch(t){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã:",t),this.items=[]}}updateCartUI(){try{const t=document.querySelector(".cart-count"),e=document.getElementById("cart-total"),r=document.getElementById("cart-content"),o=document.getElementById("empty-cart-message");if(!t||!e||!r)return void console.warn("–≠–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ä–∑–∏–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ DOM");t.textContent=this.getTotalItems(),e.textContent=this.formatPrice(this.getTotal()),0===this.items.length?(o&&o.classList.remove("hidden"),r.innerHTML="",o&&r.appendChild(o)):(o&&o.classList.add("hidden"),r.innerHTML="",this.items.forEach((t=>{const e=this.createCartItemElement(t);r.appendChild(e)})))}catch(t){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∫–æ—Ä–∑–∏–Ω—ã:",t)}}createCartItemElement(t){const e=document.createElement("div");e.className="cart-item",e.innerHTML=`\n            <img src="${t.image}" alt="${t.name}" class="cart-item__image"\n                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2Y1ZjVmNSIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTgiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IiMzMzMiPlByb2R1Y3Q8L3RleHQ+PC9zdmc+'">\n            <div class="cart-item__details">\n                <div class="cart-item__title">${t.name}</div>\n                <div class="cart-item__price">${this.formatPrice(t.price)}</div>\n            </div>\n            <div class="cart-item__actions">\n                <div class="quantity-control">\n                    <button class="quantity-control__button" data-action="decrease" data-id="${t.id}">-</button>\n                    <span class="quantity-control__value">${t.quantity}</span>\n                    <button class="quantity-control__button" data-action="increase" data-id="${t.id}">+</button>\n                </div>\n                <button class="cart-item__remove" data-id="${t.id}" aria-label="–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä">üóëÔ∏è</button>\n            </div>\n        `;const r=e.querySelector('[data-action="decrease"]'),o=e.querySelector('[data-action="increase"]'),n=e.querySelector(".cart-item__remove");return r.addEventListener("click",(()=>{this.updateQuantity(t.id,t.quantity-1)})),o.addEventListener("click",(()=>{this.updateQuantity(t.id,t.quantity+1)})),n.addEventListener("click",(()=>{this.removeFromCart(t.id)})),e}showOrderForm(){try{const t=document.getElementById("order-form-container"),e=document.getElementById("order-items"),r=document.getElementById("order-total");if(!t||!e||!r)return void console.error("–≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");e.innerHTML="",this.items.forEach((t=>{const r=document.createElement("div");r.className="order-item",r.innerHTML=`\n                    <div>${t.name} √ó ${t.quantity}</div>\n                    <div>${this.formatPrice(t.price*t.quantity)}</div>\n                `,r.style.cssText="display: flex; justify-content: space-between; margin-bottom: 0.5rem;",e.appendChild(r)})),r.textContent=this.formatPrice(this.getTotal()),t.classList.remove("hidden"),document.body.style.overflow="hidden";const o=document.getElementById("customer-name");o&&o.focus()}catch(t){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞:",t)}}closeOrderForm(){try{const t=document.getElementById("order-form-container");t&&(t.classList.add("hidden"),document.body.style.overflow="")}catch(t){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞:",t)}}openCart(){try{const t=document.getElementById("cart-modal"),e=document.getElementById("overlay");t&&e&&(t.classList.add("cart-modal--open"),e.classList.add("overlay--visible"),document.body.style.overflow="hidden")}catch(t){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã:",t)}}closeCart(){try{const t=document.getElementById("cart-modal"),e=document.getElementById("overlay");t&&e&&(t.classList.remove("cart-modal--open"),e.classList.remove("overlay--visible"),document.body.style.overflow="")}catch(t){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã:",t)}}formatPrice(t){try{return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0}).format(t)}catch(e){return console.error("–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—ã:",e),`${t} ‚ÇΩ`}}showNotification(t){try{const e=document.createElement("div");e.textContent=t,e.style.cssText="\n                position: fixed;\n                bottom: 20px;\n                right: 20px;\n                background: var(--success-color);\n                color: white;\n                padding: 12px 20px;\n                border-radius: var(--border-radius);\n                box-shadow: var(--box-shadow);\n                z-index: 10000;\n                transition: var(--transition);\n                max-width: 300px;\n            ",document.body.appendChild(e),setTimeout((()=>{e.style.opacity="0",setTimeout((()=>{e.parentNode&&e.parentNode.removeChild(e)}),300)}),3e3)}catch(t){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:",t)}}}document.addEventListener("DOMContentLoaded",(()=>{try{window.cartManager=new CartManager,console.log("–ö–æ—Ä–∑–∏–Ω–∞ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")}catch(t){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã:",t)}}));